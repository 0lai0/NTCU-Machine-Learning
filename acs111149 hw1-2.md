
# KMeans + PCA 非監督式異常偵測說明

## 實驗目的
本實驗目的是針對信用卡詐欺資料進行非監督式異常偵測，透過 KMeans 搭配 PCA 降維進行群聚分析，利用異常資料與群中心的距離來判斷潛在的詐欺交易。

---

## 資料來源與預處理
- 資料集：Kaggle [`mlg-ulb/creditcardfraud`](https://www.kaggle.com/datasets/mlg-ulb/creditcardfraud)
- 資料欄位：
  - `Time`：移除
  - `Amount`：標準化處理
  - `Class`：0 為正常交易、1 為詐欺交易
- 訓練資料中僅選用前 `1000` 筆正常資料作為 KMeans 模型訓練基礎，避免詐欺樣本污染聚類中心。

---

## 模型流程與參數設計

### PCA
- 使用主成分分析（PCA）將特徵降為 `10` 維（`n_components=10`）
- 可避免高維度對 KMeans 聚類造成干擾

### 聚類模型（KMeans）
- 自動搜尋最佳 `k` 值（群數），範圍為 `2` 到 `8`
- 評估指標：silhouette score（輪廓係數）
- 最佳 `k` 用來訓練最終 KMeans 模型

###  雙門檻異常判斷策略
- 條件一：測試資料點到最近群中心的距離超過整體 `99.4%` 分位數
- 條件二：且超過該群 cluster 的局部門檻（mean + 4 × std）
- 同時滿足兩者者視為異常

---

## 固定參數
| 參數名稱                 | 值            | 說明 |
|--------------------------|----------------|------|
| `RANDOM_SEED`            | 42             | 固定隨機性 |
| `TEST_SIZE`              | 0.3            | 測試資料占比 |
| `N_NORMAL_SEED`          | 1000           | 正常樣本取樣數量 |
| `N_PCA_COMPONENTS`       | 10             | PCA 降維維度數 |
| `CONTAMINATION_PERCENTILE` | 99.4         | 全局距離異常門檻 |
| `CLUSTER_STD_MULTIPLIER` | 4.0            | 群內異常判定標準差倍率 |

---

## 預期輸出結果格式
```plaintext
KMeans (k=5, PCA=10) @ 99.4% + ClusterFilter 評估結果:
=============================================
         Accuracy: 0.9987
  Precision Score: 0.9102
     Recall Score: 0.8035
         F1 Score: 0.8535

Classification Report:
              precision    recall  f1-score   support

           0     0.9990    0.9998    0.9994     85296
           1     0.9102    0.8035    0.8535       147

    accuracy                         0.9987     85443
   macro avg     0.9546    0.9016    0.9265     85443
weighted avg     0.9987    0.9987    0.9987     85443
```
